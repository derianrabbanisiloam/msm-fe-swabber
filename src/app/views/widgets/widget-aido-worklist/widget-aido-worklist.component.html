<div class="fo_container_input_date">
  <label class="foot-note" for="doctor_name">Appointment Date</label>
  <div class="date-picker-element">
      <my-date-range-picker name="mydaterange" [options]="myDateRangePickerOptions" [(ngModel)]="datePickerModel"
        (dateRangeChanged)="changeDateRange($event)" #date>
      </my-date-range-picker>
    </div>
  <div *ngFor="let alert of alerts">
    <ngb-alert *ngIf="alert" type="{{cssAlertType(alert)}}" (close)="removeAlert(alert)">{{ alert.message }}</ngb-alert>
  </div>
</div>

<div class="fo_container_list shadow-4">
  <table class="table table-bordered aido-appts-table">
    <thead class="fo_color_blue foot-note" style="text-align: center;">
      <th style="min-width: 14em">
        Patient Name
      </th>
      <th style="white-space: nowrap; text-align: center; min-width: 10em">Date of Birth</th>
      <th style="min-width: 8em">Multiple MR</th>
      <th>Phone No.</th>
      <th>Address</th>
      <th width="100px">App. Date</th>
      <th>App. Time</th>
      <th style="min-width: 13em">
        Doctor
      </th>
      <th>Payment Status</th>
      <th>Admission Status</th>
      <th>Channel</th>
      <th>Verify MR</th>
      <th>Eligible Status</th>
      <th hidden>App. Manage</th>
      <th>Document</th>
      <th style="min-width: 9em">Modified By</th>
      <th width="90px" style="text-align: center">Action</th>
    </thead>

    <tbody>
      <tr class="fo_header_grey filter-row">
        <td>
          <div class="inner-addon right-addon">
            <i class="glyphicon fa fa-search"></i>
            <input type="text" class="form-control" placeholder="Search name" [(ngModel)]="keywordsModel.patientName"
              (change)="getAidoWorklist()" />
          </div>
        </td>
        <td></td>
        <td>
          <div class="inner-addon right-addon">
            <select id="title" class="form-control" (change)="getAidoWorklist()" [(ngModel)]="keywordsModel.isDoubleMr"
                name="dropDownIsWaitingList">
                <option [ngValue]=undefined [selected]="keywordsModel.isDoubleMr === undefined">ALL</option>
                <option value=false>NO</option>
                <option value=true>YES</option>
              </select>
          </div>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>
          <div class="inner-addon right-addon">
            <i class="glyphicon fa fa-search"></i>
            <div class="ng-autocomplete" class="angular-autocomplete">
              <ng-autocomplete placeHolder="Search Doctor..." [data]="doctors" searchKeyword="name" [(ngModel)]="keywordsModel.doctorId"
                (selected)='getAidoWorklist()' (inputCleared)='getAidoWorklist()' [itemTemplate]="itemTemplateDoctor"
                [notFoundTemplate]="notFoundTemplate">
              </ng-autocomplete>

              <ng-template #itemTemplateDoctor let-item>
                <a [innerHTML]="item.name"></a>
              </ng-template>

              <ng-template #notFoundTemplate let-notFound>
                <div [innerHTML]="notFound"></div>
              </ng-template>
            </div>
          </div>
        </td>
        <td>
          <div class="inner-addon right-addon">
            <select id="title" class="form-control" (change)="getAidoWorklist()" [(ngModel)]="keywordsModel.payStatus"
                name="dropDownIsWaitingList">
                <option [ngValue]=undefined [selected]="keywordsModel.payStatus === undefined">ALL</option>
                <option value=1>Paid</option>
                <option value=2>Waiting</option>
                <option value=3>Payment Expired</option>
              </select>
          </div>
        </td>
        <td>
          <div class="inner-addon right-addon">
            <select id="title" class="form-control" (change)="getAidoWorklist()" [(ngModel)]="keywordsModel.admStatus"
                name="dropDownIsWaitingList">
                <option [ngValue]=undefined [selected]="keywordsModel.admStatus === undefined">ALL</option>
                <option value=1>Not Processed</option>
                <option value=2>Success</option>
                <option value=3>Failed</option>
              </select>
          </div>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>

      <tr class="aido-appt-item" *ngFor="let r of aidoAppointments; let i = index" [ngClass]="{
        'row-pink' : r.appointment_status_id === appStatusId.INACTIVE}">
        <td style="text-transform: uppercase">
          <a ngbPopover="{{r.contact_name}}" popoverTitle=""
            triggers="mouseenter:mouseleave">{{r.contact_name && r.contact_name.length > 30 ?
               r.contact_name.substr(0,30)+"..." : r.contact_name}}</a>
        </td>
        <td style="width: 1%;">{{ r.date_of_birth }}</td>
        <td style="text-align: center; white-space: nowrap; width: 1%">
          <div>
            <div *ngIf="r.is_double_mr == true">
              <span>YES</span>
            </div>
            <div *ngIf="r.is_double_mr == false">
              <span>NO</span>
            </div>
          </div>
        </td>
        <td style="text-align: center">{{ r.phone_number }}</td>
        <td style="text-align: center; white-space: nowrap;">
          <a ngbPopover="{{r.delivery_address}}" popoverTitle=""
            triggers="mouseenter:mouseleave">{{r.delivery_address && r.delivery_address.length > 10 ?
               r.delivery_address.substr(0,10)+"..." : r.delivery_address}}</a>
        </td>
        <td style="text-align: center; white-space: nowrap;">{{ r.appointment_date }}</td>
        <td style="min-width: 8em">{{ r.appointment_from_time }} - {{ r.appointment_to_time }}</td>
        <td class="kolom-type">
          <a ngbPopover="{{r.doctor_name}}" popoverTitle=""
            triggers="mouseenter:mouseleave">{{r.doctor_name && r.doctor_name.length > 30 ?
               r.doctor_name.substr(0,30)+"..." : r.doctor_name}}</a>
        </td>
        <td style="text-align: center">
          <div style="color: white;">
            <div style="background:green; border-radius: 1em; padding: 0.2em" *ngIf="r.payment_status_id === payStatus.PAID">
              <span>Paid</span>
            </div>
            <div style="background: black; border-radius: 1em;" *ngIf="r.payment_status_id === payStatus.NOTPAID">
              <span>Waiting</span>
            </div>
            <div style="background: red; border-radius: 1em; padding: 0.2em" *ngIf="r.payment_status_id === payStatus.PAYMENTEXPIRED">
              <span>Payment Expired</span>
            </div>
          </div>
        </td>
        <td style="text-align: center">
          <div style="color: white;">
            <div style="background: #CFC900; border-radius: 1em; padding: 0.2em" *ngIf="r.admission_status_id == 1">
              <span>Not Processed</span>
            </div>
            <div style="background: green; border-radius: 1em;" *ngIf="r.admission_status_id == 2">
              <span>Success</span>
            </div>
            <div style="background: red; border-radius: 1em;" *ngIf="r.admission_status_id == 3">
              <span>Failed</span>
            </div>
          </div>
        </td>
        <td>
          <div *ngIf="r.channel_id == arrChannel.AIDO">
            <span>AIDO</span>
          </div>
        </td>
        <td>
          <div *ngIf="r.patient_hope_id !== 0 && r.patient_organization_id !== 0 && r.is_double_mr === false">
            <span>Verified</span>
          </div>
        </td>
        <td>
          <div style="color: white; text-align: center;">
            <div style="background:green; border-radius: 1em; padding: 0.2em" *ngIf="r.eligible_status_id === eligibleVal.ELIGIBLE">
              <span>Eligible</span>
            </div>
            <div style="background: red; border-radius: 1em; padding: 0.2em" *ngIf="r.eligible_status_id === eligibleVal.NOT_ELIGIBLE">
              <span>Not Eligible</span>
            </div>
          </div>
        </td>
        <td hidden>
          <div *ngIf="r.appointment_status_id !== appStatusId.INACTIVE && r.admission_status_id != 2">

            <div class="cell-img-nav d-flex justify-content-center">
              <div>
                <!--Button reschedule-->
              </div>
              <span style="opacity: 0; max-width: 0.5em; overflow: hidden">filler</span>
              <div (click)="cancelAppointment(r, confirmCancel)">
                <img src="{{assetPath}}icons/ic_Cancel@2x.png">
              </div>
            </div>
            </div>
        </td>
        <td>
          <span *ngIf="r.identity_card_file">
            <a href=":javascript"
            (click)="getImage(r.identity_card_file)"
            target="_blank">{{r.identity_card_file}}<br></a>
          </span>
          <span *ngIf="r.employee_card_file">
            <a href=":javascript"
            (click)="getImage(r.employee_card_file)"
            target="_blank">{{r.employee_card_file}}<br></a>
          </span>
          <span *ngIf="r.insurance_card_file">
            <a href=":javascript"
            (click)="getImage(r.insurance_card_file)"
            target="_blank">{{r.insurance_card_file}}<br></a>
          </span>
        </td>
        <td style="text-align: center; font-size: 11px;">
          <a ngbPopover="{{r.modified_by}}" popoverTitle=""
            triggers="mouseenter:mouseleave">{{r.modified_by && r.modified_by.length > 15 ?
               r.modified_by.substr(0,15)+"..." : r.modified_by}}</a>
        </td>
        <td style="text-align: center; min-width: 12em">
        <div *ngIf="r.admission_status_id != 2 && r.appointment_status_id !== appStatusId.INACTIVE && r.payment_status_id === payStatus.PAID">
          <div *ngIf="r.patient_hope_id !== 0 && r.patient_organization_id !== 0 && r.is_double_mr === false">
            <button (click)="createAdmModal(r, confirmAdmission)" class="btn ms_btn_green" style="font-size: 11px; width: 7.5rem">Check In</button>
          </div>
          <div *ngIf="(r.patient_hope_id === 0 && r.patient_organization_id === 0 && r.is_double_mr === true)
          || (r.patient_hope_id !== 0 && r.patient_organization_id === 0 && r.is_double_mr === true)
          || (r.patient_hope_id === 0 && r.patient_organization_id === 0 && r.is_double_mr === false)
          || (r.patient_hope_id !== 0 && r.patient_organization_id === 0 && r.is_double_mr === false)">
            <button (click)="verifyAppointment(r)" class="btn ms_btn_blue verify-mr-button" style="font-size: 10px; width: 7.5rem">Verify MR</button>
          </div>
        </div>
          <div *ngIf="r.appointment_status_id !== appStatusId.INACTIVE && (r.channel_id === arrChannel.MOBILE_OTHER || r.channel_id === arrChannel.MOBILE)">
            <button (click)="cancelAppointment(r, confirmCancel)" class="btn ms_btn_red button-cancel">Cancel</button>
          </div>
          <div *ngIf="r.appointment_status_id !== appStatusId.INACTIVE && (r.channel_id === arrChannel.MOBILE_OTHER || r.channel_id === arrChannel.MOBILE)">
            <button (click)="rescheduleAppointment(r)" class="btn ms_btn_black reschedule-button">Reschedule</button>
          </div>
        <div *ngIf="r.appointment_status_id !== appStatusId.INACTIVE && ((r.identity_card_file && r.employee_card_file) || (r.identity_card_file && r.insurance_card_file))
        && r.eligible_status_id === eligibleVal.NOT_YET_ELIGIBLE">
          <button (click)="eligibleModal(confirmEligible, r)" class="btn ms_btn_green_light" style="font-size: 10px; margin-top: 0.5rem; width: 7.5rem">Check Eligibility</button>
        </div>

        <div class="span-canceled" *ngIf="r.appointment_status_id === appStatusId.INACTIVE">
          Cancelled
        </div>
        </td>
      </tr>
      <tr>
        <td *ngIf="showNotFoundMsg" colspan="15" style="text-align: center;">Displaying no data</td>
        <td *ngIf="showWaitMsg" colspan="15">
          <ngb-progressbar value="1000">Loading...</ngb-progressbar>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<section class="full-width" id="group-list-appointment">
  <button *ngIf="isCanPrevPage" (click)="prevPage()" class="btn ms_btn_blue">
    <img src="{{assetPath}}icons/ic_ArrowRight_White.png"> Prev
  </button>
  <span style="width:10px">&nbsp;</span>
  <button *ngIf="isCanNextPage" (click)="nextPage()" class="btn ms_btn_blue">
    Next <img src="{{assetPath}}icons/ic_ArrowLeft_White.png">
  </button>

  <ng-template #confirmAdmission let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">Confirmation</h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure to create admission ?</p>
      <div class="fo_confirmation_button d-flex justify-content-center">
        <button type="button" class="btn fo_btn_green"
          (click)="createAdm()"
          (click)="c('Cross click')">Ok</button>
        <button type="button" class="btn fo_btn_black" (click)="c('Cross click')">Cancel</button>
      </div>
    </div>
  </ng-template>

  <ng-template #confirmCancel let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">Confirmation</h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure to cancel appointment aido of {{ selectedCancel.contact_name }} ?</p>
      <div class="fo_confirmation_button d-flex justify-content-center">
        <button type="button" class="btn fo_btn_black" (click)="cancelProcess()"
          (click)="c('Cross click')">Ok</button>
        <button type="button" class="btn fo_btn_green" (click)="c('Cross click')">Cancel</button>
      </div>
    </div>
  </ng-template>

  <ng-template #confirmEligible let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">Confirmation</h4>
      <button #close_button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div style="text-align: left">
        <table>
          <tr>
            <td>Patient Name</td>
            <td>:</td>
            <td *ngIf="appResult && appResult.contact_name">{{appResult.contact_name}}</td></tr>
          <tr>
            <td>Identity No</td>
            <td>:</td>
            <td *ngIf="appResult && appResult.identity_number">{{appResult.identity_number}}</td></tr>
          <tr>
            <td>Insurance no / Employee no</td>
            <td>:</td>
            <td *ngIf="appResult && appResult.employee_number">{{appResult.employee_number}}</td>
            <td *ngIf="appResult && appResult.insurance_number">{{appResult.insurance_number}}</td>
          </tr>
        </table>
      </div>
      <div class="fo_confirmation_button d-flex justify-content-center">
        <button type="button" class="btn fo_btn_green" [disabled]="loadingButton === true" (click)="eligibleCheck('1', confirm_submit, close_button)">Eligible</button>
        <button type="button" class="btn fo_btn_red" [disabled]="loadingButton === true" (click)="eligibleCheck('2', confirm_submit, close_button)">Not Eligible</button>
      </div>
      <div *ngFor="let alert of alerts">
        <ngb-alert *ngIf="alert" type="{{cssAlertType(alert)}}" (close)="removeAlert(alert)">{{ alert.message }}</ngb-alert>
      </div>
    </div>
  </ng-template>

  <ng-template #confirm_submit let-modal>
    <div class="modal-header">
      <div class="header-2 modal-padding">Confirmation</div>
    </div>
    <div class="modal-body">
      Are you sure?
    </div>
    <div class="modal-footer">
      <button class="btn ms_btn_green" [ngClass]="{'disable': flagConfirm}" (click)="onSubmitEligible()" (click)="modal.close()">Confirm</button>
      <button type="button" class="btn ms_btn_red" (click)="modal.close()">Cancel</button>
    </div>
  </ng-template>

</section>
